import{a as J,b as K,c as Q}from"./chunk-OT4A4H5G.js";import"./chunk-O7HXUX3S.js";import{a as G}from"./chunk-DK2NHJD3.js";import{a as j}from"./chunk-ZKTQV7EG.js";import{f as I}from"./chunk-7AUJDYC3.js";import{a as B}from"./chunk-MHTYV42J.js";import"./chunk-NKQOLO4R.js";import"./chunk-OMJYBY2Z.js";import{Z as T}from"./chunk-NVUV4KG5.js";import"./chunk-4YRY4IP2.js";import{a as H}from"./chunk-X5OPW46L.js";import{b as z,e as F,h as L,m as U,n as N,o as W,u as A}from"./chunk-SGIGSFT7.js";import"./chunk-LQDACG22.js";import{j as D,r as E}from"./chunk-GMFH3NDN.js";import{Gb as i,Hb as q,Ib as R,Kb as v,Lb as f,Mb as x,Ob as V,Pa as c,Pb as _,Qa as m,_ as P,a as C,b as M,bb as w,db as b,ha as g,ia as d,ja as S,ka as O,mb as r,nb as o,ob as h,sb as y,vb as u,wb as p}from"./chunk-ETUY2JGY.js";var X=()=>[5,10,20],Y=()=>({"min-width":"100%"});function Z(n,e){n&1&&(r(0,"tr")(1,"th",15),i(2," Solicitud "),o(),r(3,"th",16),i(4," Acciones "),o()())}function $(n,e){if(n&1){let t=y();r(0,"button",23),u("click",function(){g(t);let a=p().$implicit,l=p();return d(l.openModal(a))}),i(1," Solicitar Plazo "),o()}}function tt(n,e){if(n&1){let t=y();r(0,"tr",17)(1,"td",18),i(2),o(),r(3,"td",19)(4,"div",20),w(5,$,2,0,"button",21),r(6,"button",22),u("click",function(){let a=g(t).$implicit,l=p();return d(l.goToDetails(a.requestId))}),i(7," Ver Detalles "),o()()()()}if(n&2){let t=e.$implicit;c(2),R(" ","Solicitud #"+t.displayId," "),c(3),b("ngIf",t.status==="prestamo")}}function et(n,e){if(n&1&&(r(0,"p",38),i(1),o()),n&2){let t=p(2);c(),q(t.dateError)}}function rt(n,e){if(n&1){let t=y();r(0,"div",24)(1,"div",25)(2,"div",26)(3,"h3",27),i(4," Solicitar Aplazamiento "),o(),r(5,"button",28),u("click",function(){g(t);let a=p();return d(a.closeModal())}),S(),r(6,"svg",29),h(7,"path",30),o()()(),O(),r(8,"div",31)(9,"label",32),i(10,"Fecha de Aplazamiento"),o(),r(11,"input",33),x("ngModelChange",function(a){g(t);let l=p();return f(l.selectedDate,a)||(l.selectedDate=a),d(a)}),u("input",function(){g(t);let a=p();return d(a.validateDate())}),o(),w(12,et,2,1,"p",34),o(),r(13,"div",35)(14,"button",36),u("click",function(){g(t);let a=p();return d(a.closeModal())}),i(15," Cancelar "),o(),r(16,"button",37),u("click",function(){g(t);let a=p();return d(a.submitReturnDate())}),i(17," Solicitar "),o()()()()}if(n&2){let t=p();c(11),v("ngModel",t.selectedDate),c(),b("ngIf",t.dateError),c(4),b("disabled",!t.isDateValid)}}var k=class n{constructor(e,t,s,a){this.requestService=e;this.userService=t;this.router=s;this.sweetalertService=a}requests=[];filteredRequests=[];selectedStatus="pendiente";userId;isModalOpen=!1;selectedDate=null;dateError=null;isDateValid=!1;selectedRequest=null;requestInProgress=!1;ngOnInit(){H(),this.loadUserDetails()}loadUserDetails(){this.userService.getUserDetails().subscribe(e=>{this.userId=e.userId,this.loadRequests()},e=>{console.error("Error al obtener los detalles del usuario:",e),this.sweetalertService.error("Error al obtener los detalles del usuario."),this.userId=void 0})}loadRequests(){if(!this.userId){console.error("Usuario no autenticado."),this.sweetalertService.error("Usuario no autenticado.");return}let e={status:this.selectedStatus,userId:this.userId};this.requestService.getRequestsByFilter(e).subscribe(t=>{this.requests=t,this.filterRequests()},t=>{console.error("Error al cargar las solicitudes:",t),this.sweetalertService.error("Error al cargar las solicitudes.")})}filterRequests(){this.filteredRequests=this.requests.filter(e=>e.status===this.selectedStatus).map((e,t)=>M(C({},e),{displayId:t+1}))}onStatusChange(e){let t=e.target;this.selectedStatus=t.value,this.loadRequests()}openModal(e){this.selectedRequest=e,this.isModalOpen=!0}closeModal(){this.isModalOpen=!1,this.selectedDate=null,this.dateError=null,this.isDateValid=!1,this.selectedRequest=null}validateDate(){if(!this.selectedDate){this.dateError="La fecha es requerida.",this.isDateValid=!1;return}let e=new Date;new Date(this.selectedDate)<e?(this.dateError="La fecha debe ser igual o mayor a la fecha actual.",this.isDateValid=!1):(this.dateError=null,this.isDateValid=!0)}submitReturnDate(){if(!this.selectedRequest||!this.selectedDate){this.sweetalertService.error("Debe seleccionar una solicitud y una fecha v\xE1lida.");return}this.requestInProgress=!0,this.requestService.updateReturnDate(this.selectedRequest.requestId,this.selectedDate).subscribe({next:e=>{this.sweetalertService.success("Fecha de retorno actualizada con \xE9xito."),this.closeModal(),this.loadRequests(),this.requestInProgress=!1},error:e=>{this.sweetalertService.error(e.error.error||"Ocurri\xF3 un error al actualizar la fecha de retorno."),this.requestInProgress=!1}})}goToDetails(e){this.router.navigate(["/home/requestDetails",e])}static \u0275fac=function(t){return new(t||n)(m(G),m(j),m(I),m(B))};static \u0275cmp=P({type:n,selectors:[["app-request-view"]],standalone:!0,features:[V],decls:21,vars:10,consts:[[1,"bg-white","py-5","antialiased","dark:bg-gray-900","rounded-lg"],[1,"mx-auto","max-w-screen-xl","px-4","2xl:px-0"],[1,"mx-auto","max-w-5xl"],[1,"flex","items-center","justify-between"],[1,"text-xl","font-semibold","text-gray-900","dark:text-white","sm:text-2xl"],["for","statusFilter",1,"sr-only"],["id","statusFilter",1,"block","w-full","md:w-auto","rounded-lg","border","border-gray-300","bg-gray-50","p-2.5","text-sm","text-gray-900","focus:ring-primary-500","focus:border-primary-500","dark:border-gray-600","dark:bg-gray-700","dark:text-white","dark:focus:ring-primary-500","dark:focus:border-primary-500",3,"ngModelChange","change","ngModel"],["value","pendiente"],["value","prestamo"],["value","finalizado"],[1,"mt-8"],["currentPageReportTemplate","Mostrando {first} a {last} de {totalRecords} solicitudes","styleClass","custom-table",3,"value","rows","paginator","rowsPerPageOptions","showCurrentPageReport","tableStyle"],["pTemplate","header"],["pTemplate","body"],["class","fixed top-0 left-0 right-0 z-50 flex items-center justify-center w-full h-full bg-black bg-opacity-50",4,"ngIf"],[1,"px-6","py-3","bg-gray-50","dark:bg-gray-700","text-sm","font-semibold","text-gray-900","dark:text-white","border-b","dark:border-gray-600"],[1,"flex","justify-center","px-6","py-3","bg-gray-50","dark:bg-gray-700","text-sm","font-semibold","text-gray-900","dark:text-white","border-b","dark:border-gray-600","text-center"],[1,"dark:bg-gray-800","hover:bg-gray-50","dark:hover:bg-gray-700"],[1,"px-6","py-4","text-gray-700","dark:text-gray-300","border-b","dark:border-gray-600"],[1,"px-6","py-4","border-b","dark:border-gray-600"],[1,"flex","justify-center","gap-4"],["type","button","class","flex items-center justify-center rounded-lg bg-blue-700 px-4 py-2 text-sm font-medium text-white hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",3,"click",4,"ngIf"],["type","button",1,"flex","items-center","justify-center","rounded-lg","bg-gray-700","px-4","py-2","text-sm","font-medium","text-white","hover:bg-gray-800","focus:outline-none","focus:ring-4","focus:ring-gray-300","dark:bg-gray-600","dark:hover:bg-gray-700","dark:focus:ring-gray-800",3,"click"],["type","button",1,"flex","items-center","justify-center","rounded-lg","bg-blue-700","px-4","py-2","text-sm","font-medium","text-white","hover:bg-blue-800","focus:outline-none","focus:ring-4","focus:ring-blue-300","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800",3,"click"],[1,"fixed","top-0","left-0","right-0","z-50","flex","items-center","justify-center","w-full","h-full","bg-black","bg-opacity-50"],[1,"bg-white","rounded-lg","shadow-lg","dark:bg-gray-700","max-w-md","w-full"],[1,"flex","items-start","justify-between","p-4","border-b","border-gray-200","dark:border-gray-600"],[1,"text-lg","font-semibold","text-gray-900","dark:text-white"],[1,"text-gray-400","hover:text-gray-900","dark:hover:text-white",3,"click"],["fill","currentColor","viewBox","0 0 20 20",1,"w-5","h-5"],["fill-rule","evenodd","d","M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 011.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule","evenodd"],[1,"p-6"],["for","postponeDate",1,"block","text-sm","font-medium","text-gray-900","dark:text-white","mb-2"],["type","date","id","postponeDate",1,"block","w-full","p-2.5","border","rounded-lg","text-sm","text-gray-900","bg-gray-50","border-gray-300","focus:ring-blue-500","focus:border-blue-500","dark:bg-gray-600","dark:border-gray-500","dark:text-white","dark:focus:ring-blue-500","dark:focus:border-blue-500",3,"ngModelChange","input","ngModel"],["class","mt-2 text-sm text-red-600 dark:text-red-400",4,"ngIf"],[1,"flex","justify-end","p-4","border-t","border-gray-200","dark:border-gray-600"],[1,"mr-5","px-4","py-2","text-sm","font-medium","text-gray-700","bg-gray-200","rounded-lg","hover:bg-gray-300","dark:bg-gray-600","dark:text-white","dark:hover:bg-gray-700",3,"click"],[1,"px-4","py-2","text-sm","font-medium","text-white","bg-blue-700","rounded-lg","hover:bg-blue-800","focus:ring-4","focus:ring-blue-300","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"],[1,"mt-2","text-sm","text-red-600","dark:text-red-400"]],template:function(t,s){t&1&&(r(0,"section",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),i(5," Todas las Solicitudes "),o(),r(6,"div")(7,"label",5),i(8,"Filtrar por estado"),o(),r(9,"select",6),x("ngModelChange",function(l){return f(s.selectedStatus,l)||(s.selectedStatus=l),l}),u("change",function(l){return s.onStatusChange(l)}),r(10,"option",7),i(11,"Pendiente"),o(),r(12,"option",8),i(13,"En pr\xE9stamo"),o(),r(14,"option",9),i(15,"Finalizado"),o()()()(),h(16,"div",10),r(17,"p-table",11),w(18,Z,5,0,"ng-template",12)(19,tt,8,2,"ng-template",13),o()()(),w(20,rt,18,3,"div",14),o()),t&2&&(c(9),v("ngModel",s.selectedStatus),c(8),b("value",s.filteredRequests)("rows",5)("paginator",!0)("rowsPerPageOptions",_(8,X))("showCurrentPageReport",!0)("tableStyle",_(9,Y)),c(3),b("ngIf",s.isModalOpen))},dependencies:[A,N,W,z,U,F,L,E,D,Q,K,T,J],styles:["[_nghost-%COMP%]     .custom-table{--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .custom-table:is(.dark *){--tw-border-opacity: 1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .custom-table .p-datatable-wrapper{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .custom-table .p-datatable-wrapper:is(.dark *){--tw-bg-opacity: 1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .custom-table .p-datatable-header{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .custom-table .p-datatable-header:is(.dark *){--tw-bg-opacity: 1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .custom-table .p-datatable-thead>tr>th{--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(17 24 39 / var(--tw-text-opacity, 1))}[_nghost-%COMP%]     .custom-table .p-datatable-thead>tr>th:is(.dark *){--tw-border-opacity: 1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}[_nghost-%COMP%]     .custom-table .p-datatable-tbody>tr{--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .custom-table .p-datatable-tbody>tr:is(.dark *){--tw-border-opacity: 1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .custom-table .p-datatable-tbody>tr:hover{--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .custom-table .p-datatable-tbody>tr:hover:is(.dark *){--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .p-paginator{--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .p-paginator:is(.dark *){--tw-border-opacity: 1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .p-paginator{position:relative;z-index:1}[_nghost-%COMP%]     .p-paginator .p-paginator-pages .p-paginator-page{--tw-text-opacity: 1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-paginator-pages .p-paginator-page:is(.dark *){--tw-text-opacity: 1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-paginator-pages .p-paginator-page.p-highlight{--tw-bg-opacity: 1;background-color:rgb(26 86 219 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-dropdown{--tw-border-opacity: 1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-dropdown:is(.dark *){--tw-border-opacity: 1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-dropdown-panel{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-dropdown-panel:is(.dark *){--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-dropdown-panel{z-index:100}[_nghost-%COMP%]     .p-paginator .p-dropdown-items{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-dropdown-items:is(.dark *){--tw-bg-opacity: 1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-dropdown-item{--tw-text-opacity: 1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-dropdown-item:is(.dark *){--tw-text-opacity: 1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-dropdown-item:hover{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-dropdown-item:hover:is(.dark *){--tw-bg-opacity: 1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .p-dropdown-panel{position:absolute!important;top:100%!important}[_nghost-%COMP%]     .p-paginator .p-dropdown{height:2rem}[_nghost-%COMP%]     .p-paginator .p-paginator-current{--tw-text-opacity: 1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-paginator-current:is(.dark *){--tw-text-opacity: 1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-paginator-first, [_nghost-%COMP%]     .p-paginator .p-paginator-prev, [_nghost-%COMP%]     .p-paginator .p-paginator-next, [_nghost-%COMP%]     .p-paginator .p-paginator-last{--tw-text-opacity: 1;color:rgb(55 65 81 / var(--tw-text-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-paginator-first:is(.dark *), [_nghost-%COMP%]     .p-paginator .p-paginator-prev:is(.dark *), [_nghost-%COMP%]     .p-paginator .p-paginator-next:is(.dark *), [_nghost-%COMP%]     .p-paginator .p-paginator-last:is(.dark *){--tw-text-opacity: 1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-paginator-first:hover, [_nghost-%COMP%]     .p-paginator .p-paginator-prev:hover, [_nghost-%COMP%]     .p-paginator .p-paginator-next:hover, [_nghost-%COMP%]     .p-paginator .p-paginator-last:hover{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-paginator-first:hover:is(.dark *), [_nghost-%COMP%]     .p-paginator .p-paginator-prev:hover:is(.dark *), [_nghost-%COMP%]     .p-paginator .p-paginator-next:hover:is(.dark *), [_nghost-%COMP%]     .p-paginator .p-paginator-last:hover:is(.dark *){--tw-bg-opacity: 1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}[_nghost-%COMP%]     .p-datatable{position:relative;z-index:0}[_nghost-%COMP%]     .p-dropdown-panel .p-dropdown-items .p-dropdown-item.p-highlight{--tw-bg-opacity: 1;background-color:rgb(26 86 219 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-paginator-pages .p-paginator-page:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000);--tw-ring-opacity: 1;--tw-ring-color: rgb(63 131 248 / var(--tw-ring-opacity, 1))}[_nghost-%COMP%]     .p-paginator .p-paginator-pages .p-paginator-page:focus:is(.dark *){--tw-ring-opacity: 1;--tw-ring-color: rgb(118 169 250 / var(--tw-ring-opacity, 1))}"]})};export{k as default};
