import{f as u}from"./chunk-7AUJDYC3.js";import{b as p,d as h}from"./chunk-LQDACG22.js";import{B as i,S as l,X as s,m as n,p as a,t as o}from"./chunk-ETUY2JGY.js";var m=class r{constructor(e,t){this.http=e;this.router=t}apiUrl=`${h.apiUrl}/users`;sessionExpiringSubject=new n(!1);expirationWarningTime=5*60*1e3;register(e){return this.http.post(`${this.apiUrl}/register`,e,{withCredentials:!0})}login(e){return this.http.post(`${this.apiUrl}/login`,e,{withCredentials:!0})}getUserDetails(){return this.http.get(`${this.apiUrl}/me`,{withCredentials:!0})}extendSession(){return this.http.post(`${this.apiUrl}/extend-session`,{},{withCredentials:!0})}logout(){this.http.post(`${this.apiUrl}/logout`,{},{withCredentials:!0}).subscribe({next:()=>{localStorage.removeItem("selectedComponents"),this.router.navigate(["/"])},error:e=>{console.error("Error al cerrar sesi\xF3n:",e),localStorage.removeItem("selectedComponents")}})}isAuthenticated(){return this.http.get(`${this.apiUrl}/authenticated`,{withCredentials:!0})}getRemainingTime(){return this.http.get(`${this.apiUrl}/session-time`,{withCredentials:!0}).pipe(o(e=>e.remainingTime),i(()=>(console.error("Error al obtener el tiempo restante de la sesi\xF3n."),a(0))))}checkSessionExpiration(){this.getRemainingTime().subscribe(e=>{e<=this.expirationWarningTime?this.sessionExpiringSubject.next(!0):this.sessionExpiringSubject.next(!1)})}startSessionExpirationCheck(){setInterval(()=>this.checkSessionExpiration(),1e3)}isSessionExpiring(){return this.sessionExpiringSubject.asObservable()}updateUser(e,t){return this.http.put(`${this.apiUrl}/${e}`,t,{withCredentials:!0})}getAllUsers(){return this.http.get(`${this.apiUrl}/all`,{withCredentials:!0})}filterUsersByName(e,t){return t?(t=t.toLowerCase(),e.filter(b=>b.name.toLowerCase().includes(t))):e}requestPasswordReset(e){return this.http.post(`${this.apiUrl}/reset-password`,{email:e},{withCredentials:!0}).pipe(i(t=>{throw t.status===404?new Error("No existe ning\xFAn usuario registrado con este correo electr\xF3nico"):new Error("Error al procesar la solicitud de recuperaci\xF3n de contrase\xF1a")}))}validateEmail(e){return/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(e)}static \u0275fac=function(t){return new(t||r)(s(p),s(u))};static \u0275prov=l({token:r,factory:r.\u0275fac,providedIn:"root"})};export{m as a};
