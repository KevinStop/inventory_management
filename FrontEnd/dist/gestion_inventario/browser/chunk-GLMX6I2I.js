import{a as V}from"./chunk-ZKTQV7EG.js";import"./chunk-7AUJDYC3.js";import{a as z}from"./chunk-MHTYV42J.js";import"./chunk-NKQOLO4R.js";import{a as A}from"./chunk-OLCSHRYT.js";import"./chunk-OMJYBY2Z.js";import"./chunk-NVUV4KG5.js";import"./chunk-4YRY4IP2.js";import{b as T,e as L,h as W,u as j}from"./chunk-SGIGSFT7.js";import{d as N}from"./chunk-LQDACG22.js";import{j as D,r as M}from"./chunk-GMFH3NDN.js";import{Gb as d,Ib as x,Kb as _,Lb as w,Mb as y,Ob as P,Pa as s,Qa as C,_ as I,bb as c,db as m,ha as u,hb as b,ia as g,ja as U,mb as o,nb as a,ob as k,sb as f,vb as h,wb as l}from"./chunk-ETUY2JGY.js";function R(r,t){if(r&1){let e=f();o(0,"label",19)(1,"input",20),h("change",function(n){u(e);let p=l();return g(p.onImageSelected(n))}),a(),U(),o(2,"svg",21),k(3,"path",22),a()()}}function B(r,t){if(r&1){let e=f();o(0,"input",23),y("ngModelChange",function(n){u(e);let p=l();return w(p.updatedData.name,n)||(p.updatedData.name=n),g(n)}),a()}if(r&2){let e=l();b("mt-1 px-3 py-2 bg-gray-50 border text-gray-900 rounded-lg shadow-sm w-full dark:bg-gray-800 dark:text-white "+(e.formErrors.name?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600")),_("ngModel",e.updatedData.name)}}function G(r,t){if(r&1&&(o(0,"p",24),d(1),a()),r&2){let e=l();s(),x(" ",e.formErrors.name," ")}}function Z(r,t){if(r&1&&(o(0,"p",25),d(1),a()),r&2){let e=l();s(),x(" ",e.user.name," ")}}function q(r,t){if(r&1){let e=f();o(0,"input",23),y("ngModelChange",function(n){u(e);let p=l();return w(p.updatedData.lastName,n)||(p.updatedData.lastName=n),g(n)}),a()}if(r&2){let e=l();b("mt-1 px-3 py-2 bg-gray-50 border text-gray-900 rounded-lg shadow-sm w-full dark:bg-gray-800 dark:text-white "+(e.formErrors.lastName?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600")),_("ngModel",e.updatedData.lastName)}}function O(r,t){if(r&1&&(o(0,"p",24),d(1),a()),r&2){let e=l();s(),x(" ",e.formErrors.lastName," ")}}function J(r,t){if(r&1&&(o(0,"p",25),d(1),a()),r&2){let e=l();s(),x(" ",e.user.lastName," ")}}function $(r,t){if(r&1){let e=f();o(0,"input",26),y("ngModelChange",function(n){u(e);let p=l();return w(p.updatedData.email,n)||(p.updatedData.email=n),g(n)}),a()}if(r&2){let e=l();b("mt-1 px-3 py-2 bg-gray-50 border text-gray-900 rounded-lg shadow-sm w-full dark:bg-gray-800 dark:text-white "+(e.formErrors.email?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600")),_("ngModel",e.updatedData.email)}}function H(r,t){if(r&1&&(o(0,"p",24),d(1),a()),r&2){let e=l();s(),x(" ",e.formErrors.email," ")}}function K(r,t){if(r&1&&(o(0,"p",25),d(1),a()),r&2){let e=l();s(),x(" ",e.user.email," ")}}function Q(r,t){if(r&1&&(o(0,"p",24),d(1),a()),r&2){let e=l(2);s(),x(" ",e.formErrors.password," ")}}function X(r,t){if(r&1){let e=f();o(0,"div")(1,"label",10),d(2,"Nueva Contrase\xF1a"),a(),o(3,"input",27),y("ngModelChange",function(n){u(e);let p=l();return w(p.updatedData.password,n)||(p.updatedData.password=n),g(n)}),a(),c(4,Q,2,1,"p",12),a()}if(r&2){let e=l();s(3),b("mt-1 px-3 py-2 bg-gray-50 border text-gray-900 rounded-lg shadow-sm w-full dark:bg-gray-800 dark:text-white "+(e.formErrors.password?"border-red-500 dark:border-red-400":"border-gray-300 dark:border-gray-600")),_("ngModel",e.updatedData.password),s(),m("ngIf",e.formErrors.password)}}function Y(r,t){if(r&1){let e=f();o(0,"button",28),h("click",function(){u(e);let n=l();return g(n.startEditing())}),d(1," Actualizar Usuario "),a()}}function ee(r,t){if(r&1){let e=f();o(0,"div",29)(1,"button",30),h("click",function(){u(e);let n=l();return g(n.saveChanges())}),d(2," Guardar "),a(),o(3,"button",31),h("click",function(){u(e);let n=l();return g(n.cancelEditing())}),d(4," Cancelar "),a()()}}var S=class r{constructor(t,e){this.userService=t;this.sweetalertService=e}apiUrl=N.apiUrl;user={userId:"",name:"",lastName:"",email:"",imageUrl:""};updatedData={name:"",lastName:"",email:"",password:""};selectedImage=null;imagePreview=null;isEditing=!1;formErrors={email:"",password:"",name:"",lastName:""};ngOnInit(){this.loadUserDetails()}validateForm(){let t=!0;this.formErrors={email:"",password:"",name:"",lastName:""};let e=this.updatedData.name.trim();e||(this.formErrors.name="El nombre es requerido",t=!1);let i=this.updatedData.lastName.trim();i||(this.formErrors.lastName="El apellido es requerido",t=!1);let n=this.updatedData.email.trim(),p=/^[a-zA-Z][a-zA-Z]?[a-zA-Z0-9]*@espe\.edu\.ec$/,F=/\.{2,}/.test(n);if(!n)this.formErrors.email="El correo electr\xF3nico es requerido",t=!1;else if(F)this.formErrors.email="El correo no puede contener puntos consecutivos",t=!1;else if(!p.test(n))this.formErrors.email="Ingrese un correo institucional v\xE1lido (@espe.edu.ec)",t=!1;else{let v=e.charAt(0).toLowerCase(),E=n.split("@")[0];E.startsWith(v)?E.length>1&&!/^[a-zA-Z]$/.test(E[1])?(this.formErrors.email="La segunda letra del correo debe ser una letra.",t=!1):new RegExp(`^${v}[a-zA-Z]?${i.toLowerCase()}[0-9]*$`).test(E)||(this.formErrors.email=`El correo debe iniciar con "${v}[cualquier letra]${i.toLowerCase()}" seguido de n\xFAmeros opcionales.`,t=!1):(this.formErrors.email=`El correo debe iniciar con "${v}[segundo nombre]${i.toLowerCase()}"`,t=!1)}return this.updatedData.password&&this.updatedData.password.length<6&&(this.formErrors.password="La contrase\xF1a debe tener al menos 6 caracteres",t=!1),t}loadUserDetails(){this.userService.getUserDetails().subscribe({next:t=>{this.user={userId:t.id||t.userId,name:t.name||"No disponible",lastName:t.lastName||"No disponible",email:t.email||"No disponible",imageUrl:t.imageUrl||`${this.apiUrl}/assets/default-user.png`},this.updatedData.name=this.user.name,this.updatedData.lastName=this.user.lastName,this.updatedData.email=this.user.email},error:t=>{console.error("Error al obtener los detalles del usuario:",t)}})}onImageSelected(t){let e=t.target.files[0];if(!e.type.match(/image\/(jpeg|jpg|png)/)){this.sweetalertService.error("Solo se permiten im\xE1genes en formato JPEG, JPG o PNG.");return}if(t.target.files.length>1){this.sweetalertService.error("Solo puedes seleccionar una imagen a la vez.");return}this.selectedImage=e;let i=new FileReader;i.onload=n=>{this.imagePreview=n.target.result},i.readAsDataURL(e)}updateUser(){if(!this.validateForm()){this.sweetalertService.error("Por favor, corrija los errores en el formulario antes de continuar.");return}let t=new FormData;t.append("name",this.updatedData.name),t.append("lastName",this.updatedData.lastName),t.append("email",this.updatedData.email),this.updatedData.password&&t.append("password",this.updatedData.password),this.selectedImage&&t.append("image",this.selectedImage),this.userService.updateUser(this.user.userId,t).subscribe({next:e=>{this.sweetalertService.success("Usuario actualizado exitosamente"),this.loadUserDetails(),this.isEditing=!1},error:e=>{let i=e.error?.message||"Ocurri\xF3 un error al actualizar los datos";this.sweetalertService.error(i)}})}startEditing(){this.isEditing=!0}saveChanges(){this.updateUser()}cancelEditing(){this.isEditing=!1,this.updatedData.name=this.user.name,this.updatedData.lastName=this.user.lastName,this.updatedData.email=this.user.email,this.updatedData.password="",this.selectedImage=null,this.imagePreview=this.user.selectedImage}static \u0275fac=function(e){return new(e||r)(C(V),C(z))};static \u0275cmp=I({type:r,selectors:[["app-user-profile"]],standalone:!0,features:[P],decls:34,vars:15,consts:[[1,"bg-white","py-6","antialiased","dark:bg-gray-900","rounded-lg"],[1,"mx-auto","max-w-md","px-4"],[1,"text-center","mb-6"],[1,"text-2xl","font-semibold","text-gray-900","dark:text-white"],[1,"text-gray-500","dark:text-gray-400","text-sm"],[1,"relative","flex","justify-center","mb-6"],[1,"w-32","h-32","rounded-full","mb-2","pt-1","overflow-hidden"],["alt","Imagen de perfil","appendTo","body",1,"w-full","h-full","object-cover",3,"src","preview"],["class","absolute bottom-0 right-0 cursor-pointer bg-blue-600 rounded-full p-2 hover:bg-blue-700",4,"ngIf"],[1,"space-y-4"],[1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-400"],["type","text","style","text-transform: uppercase;",3,"ngModel","class","ngModelChange",4,"ngIf"],["class","mt-1 text-sm text-red-500 dark:text-red-400",4,"ngIf"],["class","mt-1 px-3 py-2 bg-gray-50 border border-gray-300 text-gray-900 rounded-lg shadow-sm dark:bg-gray-800 dark:text-white dark:border-gray-600",4,"ngIf"],["type","email",3,"ngModel","class","ngModelChange",4,"ngIf"],[4,"ngIf"],[1,"mt-6","text-center"],["type","button","class","px-6 py-2 text-sm font-medium text-white bg-blue-700 rounded-lg shadow hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",3,"click",4,"ngIf"],["class","flex justify-center gap-4",4,"ngIf"],[1,"absolute","bottom-0","right-0","cursor-pointer","bg-blue-600","rounded-full","p-2","hover:bg-blue-700"],["type","file","accept","image/jpeg, image/jpg, image/png","hidden","",3,"change"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke-width","2","stroke","white",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","d","M15.232 5.232l3.536 3.536m-2.036-5.036A2.5 2.5 0 0118.5 8.5L7.5 19.5H3v-4.5L14 3.5a2.5 2.5 0 013.5 0z"],["type","text",2,"text-transform","uppercase",3,"ngModelChange","ngModel"],[1,"mt-1","text-sm","text-red-500","dark:text-red-400"],[1,"mt-1","px-3","py-2","bg-gray-50","border","border-gray-300","text-gray-900","rounded-lg","shadow-sm","dark:bg-gray-800","dark:text-white","dark:border-gray-600"],["type","email",3,"ngModelChange","ngModel"],["type","password",3,"ngModelChange","ngModel"],["type","button",1,"px-6","py-2","text-sm","font-medium","text-white","bg-blue-700","rounded-lg","shadow","hover:bg-blue-800","focus:outline-none","focus:ring-4","focus:ring-blue-300","dark:bg-blue-600","dark:hover:bg-blue-700","dark:focus:ring-blue-800",3,"click"],[1,"flex","justify-center","gap-4"],["type","button",1,"px-6","py-2","text-sm","font-medium","text-white","bg-green-600","rounded-lg","shadow","hover:bg-green-700","focus:outline-none","focus:ring-4","focus:ring-green-300","dark:bg-green-700","dark:hover:bg-green-800","dark:focus:ring-green-800",3,"click"],["type","button",1,"px-6","py-2","text-sm","font-medium","text-white","bg-gray-600","rounded-lg","shadow","hover:bg-gray-700","focus:outline-none","focus:ring-4","focus:ring-gray-300","dark:bg-gray-700","dark:hover:bg-gray-800","dark:focus:ring-gray-800",3,"click"]],template:function(e,i){e&1&&(o(0,"section",0)(1,"div",1)(2,"div",2)(3,"h2",3),d(4," Perfil de Usuario "),a(),o(5,"p",4),d(6," Visualiza la informaci\xF3n b\xE1sica del usuario. "),a()(),o(7,"div",5)(8,"div",6),k(9,"p-image",7),a(),c(10,R,4,0,"label",8),a(),o(11,"div",9)(12,"div")(13,"label",10),d(14,"Nombre"),a(),c(15,B,1,3,"input",11)(16,G,2,1,"p",12)(17,Z,2,1,"p",13),a(),o(18,"div")(19,"label",10),d(20,"Apellido"),a(),c(21,q,1,3,"input",11)(22,O,2,1,"p",12)(23,J,2,1,"p",13),a(),o(24,"div")(25,"label",10),d(26,"Correo Institucional"),a(),c(27,$,1,3,"input",14)(28,H,2,1,"p",12)(29,K,2,1,"p",13),a(),c(30,X,5,4,"div",15),a(),o(31,"div",16),c(32,Y,2,0,"button",17)(33,ee,5,0,"div",18),a()()()),e&2&&(s(9),m("src",i.imagePreview?i.imagePreview:i.apiUrl+i.user.imageUrl)("preview",!0),s(),m("ngIf",i.isEditing),s(5),m("ngIf",i.isEditing),s(),m("ngIf",i.isEditing&&i.formErrors.name),s(),m("ngIf",!i.isEditing),s(4),m("ngIf",i.isEditing),s(),m("ngIf",i.isEditing&&i.formErrors.lastName),s(),m("ngIf",!i.isEditing),s(4),m("ngIf",i.isEditing),s(),m("ngIf",i.isEditing&&i.formErrors.email),s(),m("ngIf",!i.isEditing),s(),m("ngIf",i.isEditing),s(2),m("ngIf",!i.isEditing),s(),m("ngIf",i.isEditing))},dependencies:[M,D,j,T,L,W,A],encapsulation:2})};export{S as default};
